<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElGamal Encryption</title>
    <style>
        textarea, input[type="text"] {
            width: 300px;
            height: 30px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Mã hóa và giải mã ElGamal</h1>

    <!-- Phần khóa -->
    <h2>Khóa</h2>
    <label for="privateKey">Khóa bí mật:</label><br>
    <input type="text" id="privateKey" readonly><br>
    <label for="publicKey">Khóa công khai:</label><br>
    <input type="text" id="publicKey" readonly><br>

    <!-- Phần mã hóa -->
    <h2>Mã hóa</h2>
    <label for="messageEncrypt">Nhập số cần mã hóa:</label><br>
    <input type="text" id="messageEncrypt"><br>
    <button onclick="encrypt()">Mã hóa</button><br>
    <label for="ciphertext">Số đã mã hóa:</label><br>
    <textarea id="ciphertext" readonly></textarea><br>

    <!-- Phần giải mã -->
    <h2>Giải mã</h2>
    <label for="ciphertextDecrypt">Nhập số đã mã hóa:</label><br>
    <textarea id="ciphertextDecrypt"></textarea><br>
    <button onclick="decrypt()">Giải mã</button><br>
    <label for="decryptedMessage">Số đã giải mã:</label><br>
    <input type="text" id="decryptedMessage" readonly><br>

    <script>
        // Hàm tính lũy thừa theo modulo
        function powerMod(base, exponent, modulus) {
            if (modulus === 1) return 0;
            let result = 1;
            base = base % modulus;
            while (exponent > 0) {
                if (exponent % 2 === 1) {
                    result = (result * base) % modulus;
                }
                exponent = exponent >> 1;
                base = (base * base) % modulus;
            }
            return result;
        }

        // Hàm tạo số ngẫu nhiên
        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Hàm tạo khóa
        function generateKeys() {
            const p = 541; // Số nguyên tố lớn
            const g = 10; // Nguyên tố g nhỏ hơn p và là phần tử nguyên thủy modulo p
            const a = getRandomNumber(2, p - 1); // Khóa bí mật
            const b = powerMod(g, a, p); // Khóa công khai
            document.getElementById("privateKey").value = a;
            document.getElementById("publicKey").value = b;
        }

        // Hàm mã hóa
        function encrypt() {
            const message = parseInt(document.getElementById("messageEncrypt").value);
            const p = 541; // Số nguyên tố lớn
            const g = 10; // Nguyên tố g nhỏ hơn p và là phần tử nguyên thủy modulo p
            const b = parseInt(document.getElementById("publicKey").value); // Khóa công khai
            const k = getRandomNumber(2, p - 1); // Số ngẫu nhiên
            const y = powerMod(g, k, p); // Tính y

            const encryptedMessage = {
                c1: powerMod(g, k, p),
                c2: (message * powerMod(y, k, p)) % p
            };

            document.getElementById("ciphertext").value = `(${encryptedMessage.c1},${encryptedMessage.c2})`;
        }

        // Hàm giải mã
        function decrypt() {
            const encryptedMessageStr = document.getElementById("ciphertextDecrypt").value;
            const [c1, c2] = encryptedMessageStr.slice(1, -1).split(',').map(Number);
            const p = 541; // Số nguyên tố lớn
            const a = parseInt(document.getElementById("privateKey").value); // Khóa bí mật

            const s = powerMod(c1, a, p);
            const m = (c2 * powerMod(s, p - 1 - a, p)) % p;
            const result = m < 0 ? m + p : m; // Xử lý nếu m là số âm
            document.getElementById("decryptedMessage").value = result;
        }

        // Tạo khóa khi trang được tải
        generateKeys();
    </script>
</body>
</html>
